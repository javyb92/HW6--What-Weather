<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Weather Dashboard</title>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
      <link rel="stylesheet" href="style.css">
      <link href="https://fonts.googleapis.com/css?family=Arimo|Open+Sans|Roboto&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.12.0/js/all.js"></script>
</head>
<header class="container-fluid"><i class="fas fa-feather-alt" id="logo"></i>Weather Feather</header>
<body>
<main>
    <section class= "container-fluid row">
        <article class="col-lg-3" id="form">
          <form id= "city-form">
            <label for="citySearch-input"></label>
            <input type="text" id="citySearch-input">

            <input id="searchCity" type="submit" value="SEARCH"></input>
          </form>
          <div class="buttons-view">
          </div>
        </article>
        <article class="col-lg-9" id="weather-info">
            <div class="row" id="module">
              <div class="container" id="city"></div>
              <div class="container" id="temp"></div>
              <div class="container" id="cond"></div>
              <div class="container" id="humidity"></div>
              <div class="container" id="wind"></div>
              <div class="container" id="uv-Index"><p id= "uvIndexValue"></div>
            </div>
            <div class="row" id="module">
              <div class="col-lg-2" id="forcastday1"></div>
              <div class="col-lg-2" id="forcastday2"></div>
              <div class="col-lg-2" id="forcastday3"></div>
              <div class="col-lg-2" id="forcastday4"></div>
              <div class="col-lg-2" id="forcastday5"></div>
            </div>
        </article>
    </section>
    <!-- Script Below -->
    <script type= "text/javascript">
      var apiKey ="5e8c1329c961bfa711486ebbeb59f577";
      var citiesLocal = JSON.parse(window.localStorage.getItem('cityHistory')) || [] 
      renderButtons()

      function getDataUpdateHTML(city) {
        var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + apiKey;
        var query5dayURL = "https://api.openweathermap.org/data/2.5/forecast?q=" + city + "&units=imperial&appid=" + apiKey;
        
        //Top module script, displays today info
        $.ajax({url: queryURL, method: "GET"}).then(function (response) {
              $("#city").html("<h1>Weather in " + response.name + "</h1>");
              $("#temp").html("<h2>" + Math.ceil (response.main.temp) + " degrees" + "</h2>");
              $("#cond").html("<h3>" + response.weather[0].main + "</h3>");
              $("#humidity").html("<h2>"+ "Humidity " + Math.ceil (response.main.humidity) + "</h2>");
              $("#wind").html(" <h2>" + Math.ceil(response.wind.speed) + " mph" + "</h2>");
        
        //Long & Lat coordinates grabbed from queryURL for UV Index api 
                var lonCoordinates = response.coord.lon;
                var latCoordinates = response.coord.lat;
                var uvindexURL= "http://api.openweathermap.org/data/2.5/uvi?"+ "appid=" +apiKey + "&lat="+ latCoordinates +"&lon="+ lonCoordinates;
        
        // UV Index api, then displays with top module
              $.ajax({url: uvindexURL, method: "GET"}).then(function (response) {
              $("#uvIndexValue").html(" <h2>" + "UV Index: "+ response.value + "</h2>");
                  // console.log(response);
              })

          })
       
        //Bottom module script, displays 5 day forecast info
        $.ajax({url: query5dayURL, method: "GET"}).then(function (response) {
          //console.log(response)
              $("#forcastday1").html("<p>" + "Tomorrow"+"</p>"+"<p>"+ "Hi "  + Math.ceil(response.list[0].main.temp_max) + " / Lo"+ Math.ceil(response.list[0].main.temp_min)+ "</p>" + "<p>"+"Humidity "+ response.list[0].main.humidity + "%"+"</p>");
              $("#forcastday2").html("<p>" + response.list[8].dt_txt + "</p>" + "<p>"+ "Hi "  + Math.ceil(response.list[8].main.temp_max)  +  "</p>" + "<p>"+"Humidity " + response.list[8].main.humidity + "%"+"</p>");
              $("#forcastday3").html("<p>" + response.list[16].dt_txt + "</p>" + "<p>"+ "Hi " + Math.ceil(response.list[16].main.temp_max) + "</p>" + "<p>"+"Humidity "  + response.list[16].main.humidity + "%"+"</p>");
              $("#forcastday4").html("<p>" + response.list[24].dt_txt + "</p>" + "<p>" + "Hi "+ Math.ceil(response.list[24].main.temp_max) +  "</p>" + "<p>"+"Humidity " + response.list[24].main.humidity + "%"+"</p>");
              $("#forcastday5").html("<p>" + response.list[32].dt_txt + "</p>" + "<p>"+ "Hi " + Math.ceil(response.list[32].main.temp_max) +  "</p>" + "<p>"+"Humidity " + response.list[32].main.humidity + "%"+"</p>");
              
          })
      }
      // Search function, click search to execute
      $("#searchCity").on("click", function (event) { 
        var city = $("#citySearch-input").val();

        citiesLocal.push(city)
        window.localStorage.setItem('cityHistory', JSON.stringify(citiesLocal));

        event.preventDefault();

        getDataUpdateHTML(city)
        renderButtons()
      });

      $(".historybtn").on("click", function (event) { 
        var city = $(event.target).data('city');
        getDataUpdateHTML(city)
      });

      // render buttons work in progress
      function renderButtons() {
        console.log(window.localStorage.getItem("cityHistory"));

        var city= $("#citySearch-input").val().trim();

        $(".buttons-view").empty();

        for (var i = 0; i < citiesLocal.length; i++) { 

          $(".buttons-view").append(
            '<button data-city=' + citiesLocal[i] + ' class="historybtn">' 
            + citiesLocal[i] + 
            '<button>'
          );


        //from tutoring session
       // var cities = window.localStorage.getItem("cityHistory");

        //Array.prototype.forEach.call(cities, function(city, index) {
         // console.log(city);
       // })
      }
    }
    
    </script> 
</main>
</body>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous">
</script>
</html>